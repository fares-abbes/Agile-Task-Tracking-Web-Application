<app-navbar></app-navbar>

<div class="min-h-screen bg-black text-white py-12 px-4">
  <div class="max-w-6xl mx-auto">

    <!-- Header (black, compact like Generate Tasks) -->
    <div class="flex items-start gap-4 mb-8 bg-black/90 p-6 rounded-lg border border-white/5 shadow-sm">
      <div>
        <h1 class="text-2xl font-extrabold">My Test Reports</h1>
        <p class="text-sm text-gray-400 mt-1">View test reports for your assigned tasks</p>
      </div>

      <div class="ml-auto flex items-center gap-3">
        <button class="inline-flex items-center px-4 py-2 rounded-full bg-emerald-400 text-zinc-900 font-semibold shadow-sm">
          Download CSV
        </button>
        <button class="inline-flex items-center px-3 py-2 rounded-md bg-transparent border border-white/5 text-gray-300">
          Filters
        </button>
      </div>
    </div>

    <!-- Body card (all black) -->
    <div class="bg-black/90 border border-white/5 rounded-lg shadow overflow-hidden">
      <!-- Loading -->
      <div *ngIf="reportsLoading" class="p-8 text-center text-gray-400">
        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-500 mx-auto"></div>
        <div class="mt-3">Loading reports...</div>
      </div>

      <!-- Error -->
      <div *ngIf="reportsError" class="p-6 text-center text-red-200 bg-red-900/30">
        Failed to load test reports. Please try again later.
      </div>

      <!-- Empty -->
      <div *ngIf="!reportsLoading && !reportsError && (!reports || reports.length === 0)" class="p-12 text-center text-gray-400">
        No test reports found for your tasks.
      </div>

      <!-- Table area (dark, scrollable) -->
      <div *ngIf="reports && reports.length > 0" class="overflow-auto max-h-[60vh]">
        <table class="min-w-full divide-y divide-gray-800">
          <thead class="bg-black/95 sticky top-0">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">#</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Task</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Result</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Actions</th>
            </tr>
          </thead>

          <tbody class="bg-black divide-y divide-gray-800">
            <ng-container *ngFor="let report of reports; let i = index">
              <tr class="hover:bg-gray-900 transition-colors">
                <td class="px-6 py-4 text-sm text-gray-300 w-16">{{ i + 1 }}</td>
                <td class="px-6 py-4 text-sm text-gray-300 truncate max-w-[28rem]">{{ report.task?.taksName }}</td>
                <td class="px-6 py-4 text-sm text-gray-300 whitespace-nowrap">{{ report.date | date:'mediumDate' }}</td>
                <td class="px-6 py-4 text-sm text-gray-300">
                  <span [ngClass]="{
                    'bg-green-900/40 text-green-300': report.result === 'PASS',
                    'bg-red-900/40 text-red-300': report.result === 'FAIL',
                    'bg-yellow-900/40 text-yellow-300': report.result === 'PARTIAL'
                  }" class="px-2 py-1 inline-flex text-xs font-semibold rounded-full">
                    {{ report.result }}
                  </span>
                </td>
                <td class="px-6 py-4 text-sm text-gray-300">
                  <button (click)="toggleDetails(i)" class="text-indigo-400 hover:text-indigo-300 flex items-center gap-2">
                    <span>{{ expandedIndex === i ? 'Hide' : 'View' }}</span>
                    <svg xmlns="http://www.w3.org/2000/svg" [ngClass]="{'transform rotate-180': expandedIndex === i}"
                         class="ml-1 h-4 w-4 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </button>

               
                </td>
              </tr>

              <tr *ngIf="expandedIndex === i" class="bg-gray-900">
                <td colspan="5" class="p-0">
                  <div class="p-5 border-t border-gray-800">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <h3 class="text-white font-semibold">Report Details</h3>
                        <p class="text-sm text-gray-300 mt-2">{{ report.task?.description || 'No description available' }}</p>
                        <p class="text-xs text-gray-400 mt-3">Tester: {{ report.tester?.username || 'Not assigned' }}</p>
                        <div class="mt-3 bg-black p-3 rounded text-sm text-gray-300">{{ report.overallRemarks || 'No remarks' }}</div>
                      </div>

                      <div>
                        <h3 class="text-white font-semibold">Attributes</h3>
                        <div *ngIf="!report.attributes || Object.keys(report.attributes).length === 0" class="text-sm text-gray-400 italic mt-2">
                          No attributes recorded
                        </div>
                        <div *ngIf="report.attributes && Object.keys(report.attributes).length > 0" class="mt-2 bg-black rounded">
                          <div *ngFor="let attr of report.attributes | keyvalue" class="flex items-center justify-between px-3 py-2 border-b border-gray-800 last:border-0">
                            <span class="text-sm text-gray-300">{{ attr.key }}</span>
                            <span [ngClass]="attr.value ? 'bg-green-900/40 text-green-300' : 'bg-red-900/40 text-red-300'"
                                  class="px-2 py-1 text-xs rounded-full">
                              {{ attr.value ? 'Met' : 'Not Met' }}
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>
