<app-navbar></app-navbar>

<div class=" min-h-screen bg-slate-900">
  <div class="flex">
    <!-- sidebar -->
    <div class="hidden md:block w-64">
      <app-sidebar></app-sidebar>
    </div>

    <!-- main -->
    <main class="flex-1 p-4">
      <div class="max-w-4xl mx-auto">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h1 class="text-2xl font-bold text-white">Clients</h1>
            <p class="text-sm text-slate-400">Manage clients — modern list view</p>
          </div>

          <div class="flex items-center gap-3">
            <button (click)="toggleAdd()"
                    class="px-3 py-2 bg-emerald-500 hover:bg-emerald-400 text-white rounded-md">
              {{ showAddForm ? 'Close' : 'New Client' }}
            </button>
          </div>
        </div>

        <!-- add form -->
        <form *ngIf="showAddForm" [formGroup]="addClientForm" (ngSubmit)="addClient()"
              class="mb-6 p-4 bg-slate-800/60 rounded-lg grid grid-cols-1 sm:grid-cols-3 gap-3">
          <input formControlName="clientName" placeholder="Client name"
                 class="px-3 py-2 rounded bg-slate-700 text-white col-span-2" />
          <input formControlName="contactEmail" placeholder="Email"
                 class="px-3 py-2 rounded bg-slate-700 text-white" />
          <input formControlName="phone" placeholder="Phone"
                 class="px-3 py-2 rounded bg-slate-700 text-white" />

          <div class="col-span-full flex gap-2 mt-2">
            <button type="submit" class="px-3 py-2 bg-emerald-500 text-white rounded-md">Add</button>
            <button type="button" (click)="toggleAdd()" class="px-3 py-2 bg-slate-700 text-slate-200 rounded-md">Cancel</button>
          </div>
        </form>

        <!-- status -->
        <div *ngIf="error" class="text-rose-400 mb-4">Failed to load clients.</div>
        <div *ngIf="loading" class="text-slate-400 mb-4">Loading...</div>
        <div *ngIf="!loading && clients.length === 0" class="text-slate-400 text-center py-8 rounded-lg bg-slate-800/40">
          No clients found
        </div>

        <!-- clients list -->
        <ul *ngIf="clients.length > 0" class="space-y-3">
          <li *ngFor="let c of clients" class="bg-slate-800/50 rounded-lg p-4 flex items-start justify-between gap-4 shadow">
            <div class="flex items-start gap-3 min-w-0">
              <div class="flex-none w-12 h-12 rounded-md bg-emerald-700/10 text-emerald-300 flex items-center justify-center font-semibold">
                {{ (c.clientName || '–').charAt(0) }}
              </div>

              <div class="min-w-0">
                <div class="text-sm text-slate-400">Client</div>
                <div class="text-lg font-semibold text-white truncate">{{ c.clientName }}</div>
                <div class="text-xs text-slate-400 truncate">{{ c.contactEmail || '—' }}</div>
                <div class="text-xs text-slate-500 mt-1">{{ c.phone || '—' }}</div>
              </div>
            </div>

            <div class="flex flex-col items-end gap-2">
              <div class="text-xs text-slate-400">{{ c.createdAt ? (c.createdAt | date:'short') : '—' }}</div>

              <div class="flex gap-2">
                <button *ngIf="editClientId !== c.clientId" (click)="startEdit(c)"
                        class="px-2 py-1 text-xs rounded bg-slate-700 text-slate-200">Edit</button>

                <button *ngIf="editClientId === c.clientId" (click)="updateClient()"
                        class="px-2 py-1 text-xs rounded bg-emerald-500 text-white">Save</button>

                <button (click)="deleteClient(c.clientId)" class="px-2 py-1 text-xs rounded bg-rose-600 text-white">Delete</button>
              </div>
            </div>

            <!-- inline edit area spans full width when active -->
            <div *ngIf="editClientId === c.clientId" class="col-span-full mt-3 w-full">
              <div class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-2">
                <input [formControl]="editClientForm.controls.clientName" placeholder="Name"
                       class="px-2 py-1 rounded bg-slate-700 text-white col-span-2" />
                <input [formControl]="editClientForm.controls.contactEmail" placeholder="Email"
                       class="px-2 py-1 rounded bg-slate-700 text-white" />
                <input [formControl]="editClientForm.controls.phone" placeholder="Phone"
                       class="px-2 py-1 rounded bg-slate-700 text-white" />
                <div class="col-span-full flex gap-2 mt-2 justify-end">
                  <button (click)="updateClient()" class="px-3 py-1 bg-emerald-500 text-white rounded">Save</button>
                  <button (click)="cancelEdit()" class="px-3 py-1 bg-slate-700 text-slate-200 rounded">Cancel</button>
                </div>
              </div>
            </div>
          </li>
        </ul>

      </div>
    </main>
  </div>
</div>
